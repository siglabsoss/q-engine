#!/usr/bin/env node
'use strict';

const templates = require('../templates.js');
const path = require('path');
const fs = require('fs-extra');

// const props = {
//     iAddrWidth: 16,
//     oAddrWidth: 11,
//     inputs: 3,
//     outputs: 32,
//     dataWidth: 32,
//     dmaOutStages: 1,
//     law: {
//         inmux: [1, 2, 7],
//         oumux: [8, 9, 10, 11, 14, 15],
//         selin: 4,
//         selou: 4,
//         perin: 5,
//         perou: 5,
//         baddr: 11,
//         k15: 32
//     },
//     log2slices: 5,
//     slices: 32
// };


const props = {
    VOP_NOP: {"n":"VNOP","v":0, "args":0},   
    VOP_ADD: {"n":"ADD", "v":1, "args":3},   
    VOP_SUB: {"n":"SUB", "v":2, "args":3},   
    VOP_AND: {"n":"AND", "v":3, "args":3},   
    VOP_OR:  {"n":"OR", "v":4, "args":3},   
    VOP_XOR: {"n":"XOR", "v":5, "args":3},   
    VOP_MV:  {"n":"MV",  "v":6, "args":206},
    VOP_ROL: {"n":"ROL",  "v":8, "args":2}, 
    VOP_ROR: {"n":"ROR",  "v":9, "args":2}, 
    VOP_MVXV: {"n":"MVXV",  "v":10, "args":210},
    VOP_MVK15V: {"n":"MVK15V",  "v":11, "args":111},
    VOP_MVVK15: {"n":"MVVK15",  "v":15, "args":115}, 
    KOP_NOP: {"n":"KNOP", "v":0, "args":0},
    KOP_SK1: {"n":"SK1", "v":1, "args":1},
    KOP_SK2: {"n":"SK2", "v":2, "args":1},
    KOP_SK13: {"n":"SK13", "v":5, "args":1},
    KOP_SK15:{"n":"SK15", "v":7, "args":1},
    KOP_LK8: {"n":"LK8", "v":8, "args":1},
    KOP_LK9: {"n":"LK9", "v":9, "args":1},
    KOP_LK10:{"n":"LK10", "v":10, "args":1},
    KOP_LK11:{"n":"LK11", "v":11, "args":1},
    KOP_LK13:{"n":"LK13", "v":13, "args":1},
    KOP_LK14:{"n":"LK14", "v":14, "args":1},
    KOP_LK15:{"n":"LK15", "v":15, "args":1},
    // "Register to int"
    // this string is used for assembly template veriable %0 and allows
    // us to convert string register names to their integer index
    // such as:  a0 -> 10, s0-> 8
    // if we use assembly templates that require %1 this would need to be duplicated
    r2i:{"zero":'\
(\
((\\"%0\\"==\\"t0\\") &5) |\
((\\"%0\\"==\\"t1\\") &6) |\
((\\"%0\\"==\\"t2\\") &7) |\
((\\"%0\\"==\\"s0\\") &8) |\
((\\"%0\\"==\\"s1\\") &9) |\
((\\"%0\\"==\\"a0\\") &10)|\
((\\"%0\\"==\\"a1\\") &11)|\
((\\"%0\\"==\\"a2\\") &12)|\
((\\"%0\\"==\\"a3\\") &13)|\
((\\"%0\\"==\\"a4\\") &14)|\
((\\"%0\\"==\\"a5\\") &15)|\
((\\"%0\\"==\\"a6\\") &16)|\
((\\"%0\\"==\\"a7\\") &17)|\
((\\"%0\\"==\\"s2\\") &18)|\
((\\"%0\\"==\\"s3\\") &19)|\
((\\"%0\\"==\\"s4\\") &20)|\
((\\"%0\\"==\\"s5\\") &21)|\
((\\"%0\\"==\\"s6\\") &22)|\
((\\"%0\\"==\\"s7\\") &23)|\
((\\"%0\\"==\\"s8\\") &24)|\
((\\"%0\\"==\\"s9\\") &25)|\
((\\"%0\\"==\\"s10\\")&26)|\
((\\"%0\\"==\\"s11\\")&27)|\
((\\"%0\\"==\\"t3\\") &28)|\
((\\"%0\\"==\\"t4\\") &29)|\
((\\"%0\\"==\\"t5\\") &30)|\
((\\"%0\\"==\\"t6\\") &31)\
)\
',
"one":'\
(\
((\\"%1\\"==\\"t0\\") &5) |\
((\\"%1\\"==\\"t1\\") &6) |\
((\\"%1\\"==\\"t2\\") &7) |\
((\\"%1\\"==\\"s0\\") &8) |\
((\\"%1\\"==\\"s1\\") &9) |\
((\\"%1\\"==\\"a0\\") &10)|\
((\\"%1\\"==\\"a1\\") &11)|\
((\\"%1\\"==\\"a2\\") &12)|\
((\\"%1\\"==\\"a3\\") &13)|\
((\\"%1\\"==\\"a4\\") &14)|\
((\\"%1\\"==\\"a5\\") &15)|\
((\\"%1\\"==\\"a6\\") &16)|\
((\\"%1\\"==\\"a7\\") &17)|\
((\\"%1\\"==\\"s2\\") &18)|\
((\\"%1\\"==\\"s3\\") &19)|\
((\\"%1\\"==\\"s4\\") &20)|\
((\\"%1\\"==\\"s5\\") &21)|\
((\\"%1\\"==\\"s6\\") &22)|\
((\\"%1\\"==\\"s7\\") &23)|\
((\\"%1\\"==\\"s8\\") &24)|\
((\\"%1\\"==\\"s9\\") &25)|\
((\\"%1\\"==\\"s10\\")&26)|\
((\\"%1\\"==\\"s11\\")&27)|\
((\\"%1\\"==\\"t3\\") &28)|\
((\\"%1\\"==\\"t4\\") &29)|\
((\\"%1\\"==\\"t5\\") &30)|\
((\\"%1\\"==\\"t6\\") &31)\
)\
',
"two":'\
(\
((\\"%2\\"==\\"t0\\") &5) |\
((\\"%2\\"==\\"t1\\") &6) |\
((\\"%2\\"==\\"t2\\") &7) |\
((\\"%2\\"==\\"s0\\") &8) |\
((\\"%2\\"==\\"s1\\") &9) |\
((\\"%2\\"==\\"a0\\") &10)|\
((\\"%2\\"==\\"a1\\") &11)|\
((\\"%2\\"==\\"a2\\") &12)|\
((\\"%2\\"==\\"a3\\") &13)|\
((\\"%2\\"==\\"a4\\") &14)|\
((\\"%2\\"==\\"a5\\") &15)|\
((\\"%2\\"==\\"a6\\") &16)|\
((\\"%2\\"==\\"a7\\") &17)|\
((\\"%2\\"==\\"s2\\") &18)|\
((\\"%2\\"==\\"s3\\") &19)|\
((\\"%2\\"==\\"s4\\") &20)|\
((\\"%2\\"==\\"s5\\") &21)|\
((\\"%2\\"==\\"s6\\") &22)|\
((\\"%2\\"==\\"s7\\") &23)|\
((\\"%2\\"==\\"s8\\") &24)|\
((\\"%2\\"==\\"s9\\") &25)|\
((\\"%2\\"==\\"s10\\")&26)|\
((\\"%2\\"==\\"s11\\")&27)|\
((\\"%2\\"==\\"t3\\") &28)|\
((\\"%2\\"==\\"t4\\") &29)|\
((\\"%2\\"==\\"t5\\") &30)|\
((\\"%2\\"==\\"t6\\") &31)\
)\
'
}
}

Object.keys(templates).forEach(fileName => {
    const body = templates[fileName](props);
    const outPath = path.resolve(process.cwd(), 'src', fileName);
    fs.outputFile(
        outPath,
        body,
        'utf-8',
        function (err) {
            if (err) {
                throw err;
            }
        }
    );
});
